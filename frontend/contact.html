<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact - Spread a Smile</title>
    
    <!-- Consolidated CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Page-specific CSS -->
    <style>
        .contact-content {
            padding: 80px 0;
            background: #f8f9fa;
        }

        .contact-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
        }

        .contact-form {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .contact-form h2 {
            color: #4CAF50;
            margin-bottom: 30px;
            font-size: 1.8rem;
        }

        .contact-info h2 {
            color: #4CAF50;
            margin-bottom: 30px;
            font-size: 1.8rem;
        }

        .info-item {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .info-item h3 {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .info-item p {
            color: #666;
            line-height: 1.5;
        }

        .error-message {
            display: none;
            color: #ff4444;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .char-count {
            display: block;
            color: #666;
            font-size: 0.85rem;
            margin-top: 5px;
            text-align: right;
        }

        input.valid,
        textarea.valid {
            border-color: #4CAF50;
        }

        input.invalid,
        textarea.invalid {
            border-color: #ff4444;
        }

        @media (max-width: 768px) {
            .contact-grid {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .contact-content {
                padding: 60px 0;
            }
            
            .contact-form {
                padding: 30px;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>Spread A Smile</h2>
            </div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
                <li><a href="visits.html" class="nav-link">Visits</a></li>
                <li><a href="teams.html" class="nav-link">Teams</a></li>
                <li><a href="visit-gallery.html" class="nav-link">Gallery</a></li>
                <li><a href="profile.html" class="nav-link">Profile</a></li>
                <li><a href="contact.html" class="nav-link active">Contact</a></li>
                <!-- Admin-only navigation items will be added dynamically -->
                <li><span class="nav-link" id="navUser">Welcome, User</span></li>
                <li><a href="#" class="nav-link logout-btn" id="navLogout">Logout</a></li>
            </ul>
        </div>
    </nav>

    <section class="page-header">
        <div class="container">
            <h1>Contact Us</h1>
            <p>Get in touch to join or support our initiative</p>
        </div>
    </section>

    <section class="contact-content">
        <div class="container">
            <div class="contact-grid">
                <div class="contact-form">
                    <h2>Send us a Message</h2>
                    <form id="contactForm">
                        <div class="form-group">
                            <label for="name">Full Name *</label>
                            <input type="text" id="name" name="name" placeholder="Enter your full name" required>
                            <div class="error-message">Name must be at least 2 characters</div>
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address *</label>
                            <input type="email" id="email" name="email" placeholder="your.email@example.com" required>
                            <div class="error-message">Please enter a valid email address</div>
                        </div>
                        <div class="form-group">
                            <label for="subject">Subject</label>
                            <input type="text" id="subject" name="subject" placeholder="What's this about?">
                        </div>
                        <div class="form-group">
                            <label for="message">Message *</label>
                            <textarea id="message" name="message" rows="5" placeholder="Tell us how we can help..." required></textarea>
                            <div class="error-message">Message must be at least 10 characters</div>
                            <small class="char-count" id="messageCount">0 / 10 characters minimum</small>
                        </div>
                        <button type="submit" class="btn btn-primary">Send Message</button>
                    </form>
                </div>

                <div class="contact-info">
                    <h2>Get In Touch</h2>
                    <div class="info-item">
                        <h3>üìç Address</h3>
                        <p>M.V.G.R. College of Engineering<br>College Address, City, State - Pincode</p>
                    </div>
                    <div class="info-item">
                        <h3>üìû Phone</h3>
                        <p>+91 62816 56684</p>
                    </div>
                    <div class="info-item">
                        <h3>‚úâÔ∏è Email</h3>
                        <p>contact@spreadasmile.org</p>
                    </div>
                    <div class="info-item">
                        <h3>üïí Response Time</h3>
                        <p>We typically respond within 24-48 hours</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    

    <!-- Shared JavaScript Modules -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/loading.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // Contact Form Handler
        class ContactFormManager {
          constructor() {
            this.form = document.getElementById('contactForm');
            this.nameInput = document.getElementById('name');
            this.emailInput = document.getElementById('email');
            this.subjectInput = document.getElementById('subject');
            this.messageInput = document.getElementById('message');
            this.messageCount = document.getElementById('messageCount');
            
            this.init();
          }

          init() {
            // Add validation listeners
            this.nameInput.addEventListener('input', () => this.validateName());
            this.emailInput.addEventListener('input', () => this.validateEmail());
            this.messageInput.addEventListener('input', () => this.validateMessage());

            // Form submission
            this.form.addEventListener('submit', (e) => this.handleSubmit(e));

            // Pre-fill user data if logged in
            this.prefillUserData();
          }

          prefillUserData() {
            try {
              // Check if user is logged in
              if (typeof authManager !== 'undefined' && authManager.isLoggedIn()) {
                const user = authManager.getUser();
                if (user) {
                  if (user.name) this.nameInput.value = user.name;
                  if (user.email) this.emailInput.value = user.email;
                }
              }
            } catch (error) {
              // User not logged in, no prefill - that's okay for contact form
              console.log('User not logged in, form will be empty');
            }
          }

          validateName() {
            const name = this.nameInput.value.trim();
            const isValid = name.length >= 2;
            
            if (name && !isValid) {
              this.nameInput.classList.add('invalid');
              this.nameInput.classList.remove('valid');
              this.showError(this.nameInput, true);
            } else if (name) {
              this.nameInput.classList.remove('invalid');
              this.nameInput.classList.add('valid');
              this.showError(this.nameInput, false);
            } else {
              this.nameInput.classList.remove('invalid', 'valid');
              this.showError(this.nameInput, false);
            }
            
            return isValid || !name;
          }

          validateEmail() {
            const email = this.emailInput.value.trim();
            const emailRegex = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
            const isValid = emailRegex.test(email);
            
            if (email && !isValid) {
              this.emailInput.classList.add('invalid');
              this.emailInput.classList.remove('valid');
              this.showError(this.emailInput, true);
            } else if (email) {
              this.emailInput.classList.remove('invalid');
              this.emailInput.classList.add('valid');
              this.showError(this.emailInput, false);
            } else {
              this.emailInput.classList.remove('invalid', 'valid');
              this.showError(this.emailInput, false);
            }
            
            return isValid || !email;
          }

          validateMessage() {
            const message = this.messageInput.value.trim();
            const length = message.length;
            const isValid = length >= 10;
            
            // Update character count
            this.messageCount.textContent = `${length} / 10 characters minimum`;
            
            if (length > 0 && !isValid) {
              this.messageInput.classList.add('invalid');
              this.messageInput.classList.remove('valid');
              this.showError(this.messageInput, true);
              this.messageCount.style.color = '#ff4444';
            } else if (length >= 10) {
              this.messageInput.classList.remove('invalid');
              this.messageInput.classList.add('valid');
              this.showError(this.messageInput, false);
              this.messageCount.style.color = '#4CAF50';
            } else {
              this.messageInput.classList.remove('invalid', 'valid');
              this.showError(this.messageInput, false);
              this.messageCount.style.color = '#666';
            }
            
            return isValid || length === 0;
          }

          showError(input, show) {
            const errorElement = input.nextElementSibling;
            if (errorElement && errorElement.classList.contains('error-message')) {
              errorElement.style.display = show ? 'block' : 'none';
            }
          }

          async handleSubmit(e) {
            e.preventDefault();

            // Validate all fields
            const isNameValid = this.validateName();
            const isEmailValid = this.validateEmail();
            const isMessageValid = this.validateMessage();

            if (!isNameValid || !isEmailValid || !isMessageValid) {
              showNotification('Please fix the errors before submitting', 'error');
              return;
            }

            // Get form data
            const formData = {
              name: this.nameInput.value.trim(),
              email: this.emailInput.value.trim(),
              subject: this.subjectInput.value.trim() || 'General Inquiry',
              message: this.messageInput.value.trim()
            };

            // Final validation
            if (formData.name.length < 2) {
              showNotification('Name must be at least 2 characters', 'error');
              return;
            }

            if (formData.message.length < 10) {
              showNotification('Message must be at least 10 characters', 'error');
              return;
            }

            try {
              Loading.show();
              const response = await api.submitContact(formData);
              Loading.hide();

              if (response.success) {
                showNotification('Thank you! Your message has been sent successfully. We will get back to you soon.', 'success');
                
                // Reset form
                this.form.reset();
                this.messageCount.textContent = '0 / 10 characters minimum';
                this.messageCount.style.color = '#666';
                
                // Remove validation classes
                this.form.querySelectorAll('input, textarea').forEach(field => {
                  field.classList.remove('valid', 'invalid');
                });
              } else {
                showNotification(response.message || 'Failed to send message. Please try again.', 'error');
              }
            } catch (error) {
              Loading.hide();
              console.error('Contact form submission error:', error);
              const message = error.response?.data?.message || error.message || 'An error occurred. Please try again.';
              showNotification(message, 'error');
            }
          }
        }

        // Initialize contact form when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
          // Setup navbar (always initialize; it will show appropriate items based on auth)
          try {
            if (typeof navbarManager !== 'undefined') {
              navbarManager.setupNavbar();
            }
          } catch (error) {
            console.warn('Navbar setup failed:', error);
          }
          
          // Initialize contact form
          new ContactFormManager();
        });
    </script>
</body>
</html>