<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - User Management</title>

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

  <!-- Global CSS -->
  <link rel="stylesheet" href="css/style.css" />
  <!-- Page CSS -->
  <link rel="stylesheet" href="css/pages/admin-users.css" />
  <link rel="stylesheet" href="css/pages/admin-users-enhanced.css" />
  <link rel="stylesheet" href="css/themes.css">
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="logo.png" alt="SAS Logo">
        Spread A Smile</div>
      <ul class="nav-menu" id="navMenu">
        <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
        <li><a href="visits.html" class="nav-link">Visits</a></li>
        <li><a href="teams.html" class="nav-link">Teams</a></li>
        <li><a href="visit-gallery.html" class="nav-link">Gallery</a></li>
        <li><a href="profile.html" class="nav-link">Profile</a></li>
        <li><span id="navUser" class="nav-link">Welcome, User</span></li>
        <li><a href="#" id="navLogout" class="nav-link logout-btn">Logout</a></li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Modern Page Header with Actions -->
    <header class="page-header">
      <div class="page-header-content">
        <div class="page-title-section">
          <h1>User Management</h1>
          <p>Manage volunteers, approve requests, and track user activity</p>
        </div>
        <div class="page-header-actions">
          <button class="btn btn-primary btn-with-icon" id="addUserBtn">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
            </svg>
            Add User
          </button>
          <button class="btn btn-secondary btn-with-icon" id="inviteUserBtn">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <path fill="currentColor"
                d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
            </svg>
            Invite User
          </button>
        </div>
      </div>
    </header>

    <!-- Summary Metrics Section -->
    <section class="metrics-section">
      <div class="metrics-grid">
        <div class="metric-card metric-total">
          <div class="metric-icon">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor"
                d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
            </svg>
          </div>
          <div class="metric-content">
            <div class="metric-label">Total Users</div>
            <div class="metric-value" id="metricTotalUsers">-</div>
          </div>
        </div>

        <div class="metric-card metric-active">
          <div class="metric-icon">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
            </svg>
          </div>
          <div class="metric-content">
            <div class="metric-label">Active Users</div>
            <div class="metric-value" id="metricActiveUsers">-</div>
          </div>
        </div>

        <div class="metric-card metric-pending">
          <div class="metric-icon">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor"
                d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm4.2 14.2L11 13V7h1.5v5.2l4.5 2.7-.8 1.3z" />
            </svg>
          </div>
          <div class="metric-content">
            <div class="metric-label">Pending Approvals</div>
            <div class="metric-value" id="metricPendingUsers">-</div>
          </div>
        </div>

        <div class="metric-card metric-verified">
          <div class="metric-icon">
            <svg viewBox="0 0 24 24" width="24" height="24">
              <path fill="currentColor"
                d="M23 12l-2.44-2.79.34-3.69-3.61-.82-1.89-3.2L12 2.96 8.6 1.5 6.71 4.69 3.1 5.5l.34 3.7L1 12l2.44 2.79-.34 3.7 3.61.82L8.6 22.5l3.4-1.47 3.4 1.46 1.89-3.19 3.61-.82-.34-3.69L23 12zm-12.91 4.72l-3.8-3.81 1.48-1.48 2.32 2.33 5.85-5.87 1.48 1.48-7.33 7.35z" />
            </svg>
          </div>
          <div class="metric-content">
            <div class="metric-label">Verified Users</div>
            <div class="metric-value" id="metricVerifiedUsers">-</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Unified Filter Bar -->
    <section class="filters-section">
      <div class="unified-filter-bar">
        <div class="filter-search-wrapper">
          <svg class="search-icon" viewBox="0 0 24 24" width="18" height="18">
            <path fill="currentColor"
              d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
          </svg>
          <input type="search" id="searchUsers" placeholder="Search by name, username, or email" />
        </div>
        <select id="filterRole" class="filter-select">
          <option value="">All Roles</option>
          <option value="volunteer">Volunteer</option>
          <option value="admin">Admin</option>
        </select>
        <select id="filterStatus" class="filter-select">
          <option value="">All Status</option>
          <option value="pending">Pending</option>
          <option value="approved">Approved</option>
          <option value="rejected">Rejected</option>
        </select>
        <select id="filterVerified" class="filter-select">
          <option value="">All Verification</option>
          <option value="true">Verified</option>
          <option value="false">Unverified</option>
        </select>
        <div class="filter-actions">
          <button id="applyFilters" class="btn btn-text" style="display:none;">Apply</button>
          <button id="resetFilters" class="btn btn-text" aria-label="Reset filters" title="Reset filters">
            <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
              <path fill="currentColor" d="M12 6V3L7 8l5 5V10a4 4 0 11-3.46 2l-1.74 1A6 6 0 1012 6z" />
            </svg>
            Reset
          </button>
        </div>
      </div>
      <div id="activeFilters" class="active-filters" aria-live="polite"
        style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;"></div>
    </section>


    <!-- User Table -->
    <section class="table-section">
      <!-- Bulk Controls (appear when selection active) -->
      <div class="bulk-controls"
        style="display:none; align-items:center; justify-content:space-between; margin-bottom:12px;" aria-hidden="true">
        <div class="bulk-left">
          <span id="selectionInfo">0 selected</span>
        </div>
        <div class="bulk-actions">
          <button id="bulkApprove" class="btn btn-primary">Approve</button>
          <button id="bulkReject" class="btn btn-warning">Reject</button>
          <button id="selectAllMatching" class="btn btn-light" title="Select all users matching current filters">Select
            all matching</button>
          <select id="bulkRoleSelect">
            <option value="">Change role...</option>
            <option value="volunteer">Volunteer</option>
            <option value="admin">Admin</option>
          </select>
          <button id="bulkChangeRole" class="btn btn-secondary">Apply Role</button>
          <button id="bulkDelete" class="btn btn-danger">Delete</button>
          <button id="bulkClear" class="btn btn-light">Clear</button>
        </div>
      </div>
      <div class="users-table-wrapper">
        <table class="users-table">
          <thead>
            <tr>
              <th><input type="checkbox" id="selectAll" /></th>
              <th>User</th>
              <th>Contact</th>
              <th>Role</th>
              <th>Status</th>
              <th>Verified</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="usersTbody">
            <tr>
              <td colspan="8" class="loading">Loading users...</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="table-footer">
        <div class="left-meta">
          <label for="pageSize">Show</label>
          <select id="pageSize">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
          <span id="totalCount" class="total-count">Total: 0</span>
        </div>
        <div id="pagination" class="pagination"></div>
      </div>
    </section>
  </main>

  <!-- Reject Modal -->
  <div id="rejectModal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3>Reject User</h3>
      <p>Please provide a reason (optional)</p>
      <textarea id="rejectReason" rows="3" placeholder="Reason for rejection..."></textarea>
      <div class="modal-actions">
        <button id="confirmReject" class="btn btn-danger">Reject</button>
        <button id="cancelReject" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Activity Modal -->
  <div id="activityModal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3>Activity Log</h3>
      <div id="activityList" class="activity-list"></div>
      <div class="modal-actions">
        <button id="closeActivity" class="btn btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- User Details Modal -->
  <div id="userDetailsModal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3>User Details</h3>
      <div id="userDetailsContent" class="user-details-content">
        <!-- Filled dynamically -->
      </div>
      <div class="modal-actions">
        <button id="closeUserDetails" class="btn btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Bulk Summary Modal -->
  <div id="bulkSummaryModal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3>Bulk Operation Summary</h3>
      <div id="bulkSummaryContent" class="bulk-summary-content"></div>
      <div class="modal-actions">
        <button id="retryBulk" class="btn btn-primary" style="display:none;">Retry failed</button>
        <button id="abortBulk" class="btn btn-warning" style="display:none;">Abort</button>
        <button id="closeBulkSummary" class="btn btn-secondary">Close</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/theme.js"></script>
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/api.js"></script>
  <script src="js/a11y.js"></script>
  <script src="js/navbar.js"></script>
  <script src="js/notifications.js"></script>
  <script src="js/loading.js"></script>
  <script src="js/app.js"></script>
  <script src="js/pages/admin-users.js"></script>
</body>

</html>