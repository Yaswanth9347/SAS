<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Visit Report - SAS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Consolidated CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <!-- Page-specific CSS -->
    <link rel="stylesheet" href="css/pages/visit-report.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>Spread A Smile</h2>
            </div>
            <ul class="nav-menu" id="navMenu">
                <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
                <li><a href="visits.html" class="nav-link">Visits</a></li>
                <li><a href="teams.html" class="nav-link">Teams</a></li>
                <li><a href="visit-gallery.html" class="nav-link">Gallery</a></li>
                <li><a href="profile.html" class="nav-link">Profile</a></li>
                <!-- Admin-only navigation items will be added dynamically -->
                <li><span class="nav-link" id="navUser">Welcome, User</span></li>
                <li><a href="#" class="nav-link logout-btn" id="navLogout">Logout</a></li>
            </ul>
        </div>
    </nav>

    <section class="dashboard">
        <div class="container">
            <div class="dashboard-header">
                <h1>Submit Visit Report</h1>
                <p>Share your experience and document the visit</p>
            </div>

            <div class="report-container">
                <!-- Team Selection -->
                <div class="report-section">
                    <h2><i class="fas fa-users"></i> Select Team</h2>
                    <div class="form-group">
                        <label for="teamSelect">Choose Team for Report <span style="color: #f44336;">*</span></label>
                        <select id="teamSelect" required>
                            <option value="">Loading teams...</option>
                        </select>
                        <div id="teamLoadingStatus" class="loading-status">
                            <i class="fas fa-spinner fa-spin"></i> Loading available teams...
                        </div>
                    </div>
                    <div id="teamDetails" class="team-details" style="display: none;"></div>
                </div>

                <!-- Visit Selection (shown after team selection) -->
                <div class="report-section" id="visitSelectionSection" style="display: none;">
                    <h2><i class="fas fa-calendar-check"></i> Select Visit</h2>
                    <div class="form-group">
                        <label for="visitSelect">Choose Visit to Report <span style="color: #f44336;">*</span></label>
                        <select id="visitSelect" required>
                            <option value="">Select a visit</option>
                        </select>
                        <div id="visitLoadingStatus" class="loading-status">
                            <i class="fas fa-spinner fa-spin"></i> Loading available visits...
                        </div>
                    </div>
                    <div id="visitDetails" class="visit-details" style="display: none;"></div>
                </div>

                <!-- Report Form -->
                <form id="visitReportForm" style="display: none;">
                    <!-- Basic Information -->
                    <div class="report-section">
                        <h2><i class="fas fa-info-circle"></i> Visit Details</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="childrenCount">Number of Children *</label>
                                <input type="number" id="childrenCount" name="childrenCount" required min="1" max="100">
                            </div>
                            <div class="form-group">
                                <label for="childrenResponse">Children's Response *</label>
                                <select id="childrenResponse" name="childrenResponse" required>
                                    <option value="">Select Response</option>
                                    <option value="excellent">Excellent - Very engaged and enthusiastic</option>
                                    <option value="good">Good - Participated well</option>
                                    <option value="average">Average - Moderate participation</option>
                                    <option value="poor">Poor - Limited engagement</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="topicsCovered">Topics Covered <span style="color: #f44336;">*</span></label>
                            <input type="text" id="topicsCovered" name="topicsCovered" required 
                                   placeholder="e.g., Basic Programming, Environmental Science, Art & Craft">
                            <small>Separate topics with commas</small>
                        </div>

                        <div class="form-group">
                            <label for="teachingMethods">Teaching Methods Used <span style="color: #f44336;">*</span></label>
                            <input type="text" id="teachingMethods" name="teachingMethods" required
                                   placeholder="e.g., Interactive Games, Storytelling, Hands-on Activities">
                            <small>Separate methods with commas</small>
                        </div>
                    </div>

                    <!-- Challenges & Suggestions -->
                    <div class="report-section">
                        <h2><i class="fas fa-comment-alt"></i> Feedback & Suggestions</h2>
                        <div class="form-group">
                            <label for="challengesFaced">Challenges Faced</label>
                            <textarea id="challengesFaced" name="challengesFaced" rows="3" 
                                      placeholder="Any difficulties encountered during the visit..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="suggestions">Suggestions for Improvement</label>
                            <textarea id="suggestions" name="suggestions" rows="3"
                                      placeholder="Ideas for better future visits..."></textarea>
                        </div>
                    </div>

                    <!-- Media Upload -->
                    <div class="report-section">
                        <h2><i class="fas fa-photo-video"></i> Photos & Videos</h2>
                        <div id="uploadWindowStatus" class="window-status" style="display: none;">
                            <span id="uploadWindowBadge" class="badge"></span>
                            <span id="uploadWindowMessage" class="status-message"></span>
                            <span id="uploadWindowCountdown" class="countdown"></span>
                        </div>
                        <!-- Inline alert target for upload/report errors near the upload area -->
                        <div id="uploadInlineAlert" class="upload-alert is-warning" role="alert" aria-live="polite" tabindex="-1" style="display:none"></div>
                        <p class="section-description">Upload photos and videos from your visit (Max 8 photos, 2 videos)</p>
                        
                        <div class="upload-area">
                            <div class="upload-section">
                                <h4><i class="fas fa-image"></i> Photos</h4>
                                <div class="file-upload">
                                    <input type="file" id="photoUpload" name="photos" multiple accept="image/*" class="file-input">
                                    <label for="photoUpload" class="upload-label">
                                        <span class="upload-icon"><i class="fas fa-images"></i></span>
                                        <span>Choose Photos</span>
                                    </label>
                                    <small class="upload-limit"><i class="fas fa-info-circle"></i> Max 8 photos, 10MB per file</small>
                                </div>
                                <div id="photoPreview" class="preview-grid"></div>
                            </div>

                            <div class="upload-section">
                                <h4><i class="fas fa-video"></i> Videos</h4>
                                <div class="file-upload">
                                    <input type="file" id="videoUpload" name="videos" multiple accept="video/*" class="file-input">
                                    <label for="videoUpload" class="upload-label">
                                        <span class="upload-icon"><i class="fas fa-film"></i></span>
                                        <span>Choose Videos</span>
                                    </label>
                                    <small class="upload-limit"><i class="fas fa-info-circle"></i> Max 2 videos, 10MB per file</small>
                                </div>
                                <div id="videoPreview" class="preview-grid"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Submission -->
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">
                            <i class="fas fa-undo"></i> Clear Form
                        </button>
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-paper-plane"></i> Submit Visit Report
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Loading Modal -->
    <div id="loadingModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3><i class="fas fa-cloud-upload-alt"></i> Submitting Report</h3>
            <div class="loading-spinner"></div>
            <p>Please wait while we upload your files and submit the report.</p>
            <p id="uploadProgress">Initializing...</p>
        </div>
    </div>

    <!-- Shared JavaScript Modules -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/loading.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Page-specific JavaScript -->
    <script src="js/pages/visit-report.js"></script>
</body>
</html>